# Start FROM Nvidia PyTorch image https://ngc.nvidia.com/catalog/containers/nvidia:pytorch
FROM nvcr.io/nvidia/pytorch:20.10-py3

RUN apt-get update && apt-get install -y --no-install-recommends \
        openssh-server \
        screen \
        curl \
        git \
        vim && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /usr/src/yolo
RUN git clone https://github.com/ultralytics/yolov5.git yolo && cd yolo && \
    git reset --hard 94a7f55 && \
    pip install -r requirements.txt && \
    pip install gsutil wandb notebook networkx tornado seaborn lxml && \
    /bin/bash weights/download_weights.sh

RUN mkdir -p /run/sshd && mkdir -p ~/.ssh && \
    echo "# ssh keys" > ~/.ssh/authorized_keys && \
    conda clean -ya
WORKDIR /workspace
COPY entrypoint.sh /usr/src/
ENTRYPOINT ["/bin/bash", "/usr/src/entrypoint.sh"]
# Build and Push
# docker build -t flystarhe/simplecv:yolo5.3.1 -f yolo5.3.1 .
# docker run --gpus all -d -p 9000:9000 -p 9001:9001 --ipc=host --name test -v "$(pwd)":/workspace flystarhe/simplecv:yolo5.3.1