# Start FROM Nvidia PyTorch image https://ngc.nvidia.com/catalog/containers/nvidia:pytorch
FROM nvcr.io/nvidia/pytorch:20.10-py3

RUN apt-get update && apt-get install -y --no-install-recommends \
        openssh-server \
        screen \
        curl \
        git \
        vim && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /usr/src
RUN git clone https://github.com/ultralytics/yolov5.git && cd yolov5 && \
    git reset --hard 94a7f55 && \
    pip install -r requirements.txt && \
    pip install gsutil wandb notebook networkx tornado seaborn lxml && \
    /bin/bash weights/download_weights.sh

RUN mkdir -p /run/sshd && mkdir -p ~/.ssh && \
    echo "# ssh keys" > ~/.ssh/authorized_keys && \
    conda clean -ya
WORKDIR /workspace
COPY entrypoint.sh /usr/src/
ENTRYPOINT ["/bin/bash", "/usr/src/entrypoint.sh"]
# Build and Push
# t=ultralytics/yolov5:latest && sudo docker build -t $t . && sudo docker push $t
# for v in {300..303}; do t=ultralytics/coco:v$v && sudo docker build -t $t . && sudo docker push $t; done