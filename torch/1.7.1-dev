FROM nvidia/cuda:10.2-cudnn8-devel-ubuntu18.04
ARG PYTHON_VERSION=3.8
RUN apt-get update && apt-get install -y --no-install-recommends \
        ca-certificates \
        curl \
        libjpeg-dev \
        libpng-dev && \
    rm -rf /var/lib/apt/lists/*

RUN curl -o ~/miniconda.sh https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh && \
    chmod +x ~/miniconda.sh && \
    ~/miniconda.sh -b -p /opt/conda && \
    rm ~/miniconda.sh && \
    /opt/conda/bin/conda install -y python=$PYTHON_VERSION conda-build notebook numpy && \
    /opt/conda/bin/conda install -y -c pytorch pytorch==1.7.1 torchvision==0.8.2 cudatoolkit=10.2 && \
    /opt/conda/bin/conda clean -ya
ENV PATH /opt/conda/bin:$PATH

WORKDIR /workspace
COPY entrypoint.sh /usr/src/
ENTRYPOINT ["/bin/bash", "/usr/src/entrypoint.sh"]
# Build and run
# v=1.7.1-dev
# docker build -t torch:${v} -f ${v} .
# t=test && docker run --gpus device=0 -d -p 9000:9000 --ipc=host --name ${t} -v "$(pwd)"/${t}:/workspace torch:${v} [dev|ssh|app]
# Updated: 2021-03-02