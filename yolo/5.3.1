# Start FROM Nvidia PyTorch image https://ngc.nvidia.com/catalog/containers/nvidia:pytorch
FROM nvcr.io/nvidia/pytorch:20.12-py3

RUN apt-get update && apt-get install -y --no-install-recommends curl git vim screen libgl1-mesa-glx && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /usr/src/yolo
RUN git clone https://github.com/ultralytics/yolov5.git yolo && cd yolo && \
    pip install -r requirements.txt && \
    pip install gsutil wandb albumentations scikit-learn notebook networkx tornado seaborn lxml && \
    /bin/bash weights/download_weights.sh && \
    conda install -y conda-build && \
    conda-develop /usr/src/yolo && \
    conda clean -ya

# RUN mkdir -p /run/sshd && mkdir -p ~/.ssh && echo "# ssh keys" > ~/.ssh/authorized_keys

WORKDIR /workspace
COPY entrypoint.sh /usr/src/
ENTRYPOINT ["/bin/bash", "/usr/src/entrypoint.sh"]
# Build and run
# docker build -t flystarhe/yolo:5.3.1 -f 5.3.1 .
# docker run --gpus device=0 -d -p 9000:9000 --ipc=host --name test -v "$(pwd)":/workspace flystarhe/yolo:5.3.1 [dev|ssh|app]
# Updated: 2020-12-30